# Entity Framework Core 2: Getting Started

## Packages that need to be installed

EF Core APIs are not all packaged into a single assembly. EF Core does not assume that, just because you are using one feature, you are going to be using all the features.

- **Microsoft.EntityFrameworkCore:** The base core package of EF Core (does not include the specific database provider)
- **Microsoft.EntityFrameworkCore.SqlServer:** The SQL Server provider for EF Core (NuGet’s dependencies functionality will also install the Microsoft.EntityFrameworkCore base package if you install this.)
- **Microsoft.EntityFrameworkCore.Tools:** Needed to run migrations. Add it to the data project in your solution.
- **Microsoft.EntityFrameworkCore.Design:** Needed in your startup project to support EF Core functionality. Be sure to also add references to your data and domain projects to your startup project and mark your startup project in VisualStudio as the startup project of your solution.
- **Microsoft.Extensions.Logging.Console:** Needed to log the SQL that is generated by EF Core. Install this into your data project.

## Migration Commands

Open the *Package Manager Console* and make sure the selected *Default project* is set to your *data* project.

To see the PowerShell commands for EF Core type:
get-help entityframeworkcore

**add-migration:** Adds a new migration<br/>
**drop-database:** Drops the database<br/>
**get-dbcontext:** Gets information about a DbContext type<br/>
**remove-migration:** Removes the last migration<br/>
**scaffold-dbcontext:** Scaffolds a DbContext and entity types for a database<br/>
**script-migration:** Generates a SQL script from migrations<br/>
**update-database:** Updates the database to a specified migration<br/>
**scaffold-dbcontext:** Reverse engineer an existing database to model classes

## Relationships

- An example of creating a many-to-many relationship code-first:
  - Create a mapping class (ie SamuraiBattle.cs) that has a SamuraiId and BattleId.
  - Change the Samurai class to have a SamuraiBattles property that returns a list of SamuraiBattle objects.
  - Change the Battle class to have a SamuraiBattles property that returns a list of SamuraiBattle objects.
  - EF Core won’t be able to derive the correct db table relationships that should be set up. You need to add the following code to your DbContext class (SamuraiContext in this example) to guide EF Core to create the correct relationships:<br/>
    ```
       protected override void OnModelCreating(ModelBuilder modelBuilder)
       {
          modelBuilder.Entity<SamuraiBattle>().HasKey(obj => new { obj.SamuraiId, obj.BattleId });
       }
    ```
 - An example of creating a one-to-one relationship code-first (using Samurai and SecretIdentity tables/entities):
   - Add a SamuraiId field to the SecretIdentity class:<br/>
     ```public int SamuraiId { get; set; }```
   - Add a SecretIdentity navigation property to the Samurai class:<br/>
     ```public SecretIdentity SecretIdentity { get; set; }```
